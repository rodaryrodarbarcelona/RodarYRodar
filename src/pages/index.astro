---
import Layout from "../layouts/Layout.astro";
import { useTranslations, defaultLanguage } from "../i18n/languages";
import mongoose from "mongoose";
import FilmografiaModel from "../lib/models/filmografia";
import { generateSlug, slugManager } from "../utils/slugManager.js";

type Filmografia = {
  _id: mongoose.Types.ObjectId;
  titulo: string;
  tituloEn?: string;
  tituloCat?: string;
  urlPoster?: string;
  sinopsis: string;
  sinopsisEn?: string;
  sinopsisCat?: string;
  fecha: number;
  genero?: string;
  generoEn?: string;
  generoCat?: string;
  director?: string;
  __v?: number;
};

// Obtener idioma actual
const lang = (Astro.locals as any)?.lang || defaultLanguage;
const t = useTranslations(lang);

// Función para obtener el título según el idioma
function getTitulo(item: Filmografia): string {
  if (lang === "en" && item.tituloEn) return item.tituloEn;
  if (lang === "ca" && item.tituloCat) return item.tituloCat;
  return item.titulo;
}

// Función para generar el slug de la película
function getFilmSlug(item: Filmografia): string {
  const baseSlug = generateSlug(getTitulo(item));
  return slugManager.registerSlug(baseSlug, item._id.toString());
}

// Conectar a MongoDB y obtener las últimas 3 producciones
let recentProductions: any[] = [];

try {
  // @ts-ignore - Ignoramos los errores de TypeScript ya que no lo estamos usando
  await mongoose.connect(import.meta.env.VITE_MONGO_URI);
  const results = await FilmografiaModel.find()
    .sort({ fecha: -1 })
    .limit(3)
    .lean();

  recentProductions = results;
} catch (error) {
  console.error("Error al obtener producciones:", error);
}
---

<Layout
  title={t("home") + " - Rodar y Rodar"}
  description="Rodar y Rodar - Productora cinematográfica"
>
  <!-- Hero Section -->
  <section class="py-20 relative bg-gray-900">
    <!-- Imagen de fondo con superposición -->
    <div class="absolute inset-0 overflow-hidden">
      <img
        src="https://res.cloudinary.com/dxytyvnn2/image/upload/v1755791964/IMG_0054_tkknqf.png"
        alt="Film background"
        class="w-full h-full object-cover opacity-50"
      />
      <div
        class="absolute inset-0 bg-gradient-to-b from-black/70 to-gray-900/90"
      >
      </div>
    </div>

    <div class="container mx-auto px-4 text-center relative z-10">
      <h1 class="text-5xl md:text-6xl font-bold mb-6 text-white">
        Rodar y Rodar Cine
      </h1>
      <!-- <p class="text-xl md:text-2xl max-w-3xl mx-auto mb-10 text-gray-200">
        {t("hero_description")}
      </p> -->
      <!--   <div class="flex flex-wrap justify-center gap-4">
        <a
          href="/filmografias"
          class="px-6 py-3 bg-red-800 text-white font-medium rounded-lg hover:bg-red-900 transition shadow-md"
        >
          {t("see_filmography")}
        </a>
        <a
          href="/servicios"
          class="px-6 py-3 bg-red-800 text-white font-medium rounded-lg hover:bg-red-900 transition shadow-md"
        >
          {t("our_services")}
        </a>
      </div> -->
    </div>
  </section>

  <section
    class="bg-gray-50 py-14 md:py-20 border-t border-gray-200 dark:border-gray-700"
  >
    <div class="container mx-auto px-4">
      <!-- Título según normativa oficial -->
      <h2
        class="text-2xl text-gray-900 md:text-3xl font-semibold mb-10 text-center"
      >
        {t("collaboration_with")} 
      </h2>

      <!-- Logos alineados en vertical en móvil y horizontal en escritorio -->
      <div
        class="flex flex-col md:flex-row items-center justify-center gap-10 md:gap-16"
      >
        <!-- Logo ICEC (primero según petición) -->
        <a
          href="https://icec.gencat.cat"
          target="_blank"
          rel="noopener"
          class="relative p-4 mb-4 md:mb-0 flex items-center justify-center"
          aria-label="Institut Català de les Empreses Culturals"
        >
          <img
            src="https://res.cloudinary.com/dxytyvnn2/image/upload/v1758906188/icec_logo_y3ba8v.png"
            alt="Institut Català de les Empreses Culturals"
            class="max-h-10 md:max-h-10 lg:max-h-10 w-auto object-contain dark:brightness-[1.05]"
          />
        </a>

        <!-- Logo Generalitat de Catalunya (segundo según petición) -->
        <a
          href="https://cultura.gencat.cat"
          target="_blank"
          rel="noopener"
          class="relative p-4 mb-4 md:mb-0 flex items-center justify-center"
          aria-label="Departament de Cultura - Generalitat de Catalunya"
        >
          <img
            src="https://res.cloudinary.com/dxytyvnn2/image/upload/v1758906188/gencat_beu0ew.png"
            alt="Departament de Cultura - Generalitat de Catalunya"
            class="max-h-10 md:max-h-10 lg:max-h-10 w-auto object-contain dark:brightness-[1.05]"
          />
        </a>

        <!-- Logo Catalan Films (tercero) con tamaño ajustado -->
        <a
          href="https://catalanfilms.cat/ca/qui-som"
          target="_blank"
          rel="noopener"
          class="relative p-4 flex items-center justify-center"
          aria-label="Catalan Films"
        >
          <img
            src="https://res.cloudinary.com/dxytyvnn2/image/upload/v1758904096/1610661171-cf-color_cvvfh9.png"
            alt="Catalan Films"
            class="max-h-26 md:max-h-26 lg:max-h-26 w-auto object-contain dark:brightness-[1.05]"
          />
        </a>
      </div>
    </div>
  </section>
</Layout>
