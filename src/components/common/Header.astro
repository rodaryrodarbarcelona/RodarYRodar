---
import { useTranslations } from "../../i18n/languages";
import ThemeToggle from "./ThemeToggle.jsx";
import LanguageSelector from "./LanguageSelector.jsx";

const t = useTranslations((Astro.locals as any)?.lang || "es");

// Obtener la URL actual para determinar la página activa
const currentPath = Astro.url.pathname;

// Función para verificar si una ruta está activa
function isActive(path: string): boolean {
  if (path === "/" && currentPath === "/") return true;
  if (path !== "/" && currentPath.startsWith(path)) return true;
  return false;
}
---

<header class="bg-white dark:bg-gray-900 shadow-md fixed w-full top-0 z-50">
  <div class="container mx-auto py-4 flex justify-between items-center">
    <div class="flex items-center">
      <a href="/" class="flex items-center">
        <img
          src="https://res.cloudinary.com/dvoh9w1ro/image/upload/v1702002254/logo_wakd6k.png"
          alt="Rodar y Rodar Logo"
          class="h-10"
        />
        <span class="ml-2 text-2xl font-semibold text-primary dark:text-white"
          >Rodar y Rodar</span
        >
      </a>
    </div>

    <nav class="mr-36 hidden md:flex items-center space-x-8 text-lg">
      <a
        href="/"
        class="relative pb-2 text-gray-800 hover:text-primary dark:text-white dark:hover:text-primary transition"
      >
        {t("home")}
        {
          isActive("/") && (
            <div class="absolute bottom-0 left-0 right-0 h-0.5 bg-red-500" />
          )
        }
      </a>
      <a
        href="/filmografias"
        class="relative pb-2 text-gray-800 hover:text-primary dark:text-white dark:hover:text-primary transition"
      >
        {t("filmography")}
        {
          isActive("/filmografias") && (
            <div class="absolute bottom-0 left-0 right-0 h-0.5 bg-red-500" />
          )
        }
      </a>
      <a
        href="/servicios"
        class="relative pb-2 text-gray-800 hover:text-primary dark:text-white dark:hover:text-primary transition"
      >
        {t("services")}
        {
          isActive("/servicios") && (
            <div class="absolute bottom-0 left-0 right-0 h-0.5 bg-red-500" />
          )
        }
      </a>
      <a
        href="/about"
        class="relative pb-2 text-gray-800 hover:text-primary dark:text-white dark:hover:text-primary transition"
      >
        {t("about")}
        {
          isActive("/about") && (
            <div class="absolute bottom-0 left-0 right-0 h-0.5 bg-red-500" />
          )
        }
      </a>
    </nav>

    <div class="flex items-center gap-4">
      <ThemeToggle client:load />
      <LanguageSelector client:only="react" />

      <!-- Menú móvil -->
      <button
        id="mobile-menu-button"
        class="md:hidden text-gray-800 dark:text-white"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Menú móvil desplegable -->
  <div
    id="mobile-menu"
    class="hidden md:hidden bg-white dark:bg-gray-900 shadow-md"
  >
    <div class="container mx-auto px-4 py-3 flex flex-col space-y-3">
      <a
        href="/"
        class={`relative pb-2 text-gray-800 hover:text-primary dark:text-white dark:hover:text-primary transition ${
          isActive("/") ? "border-b-2 border-red-500" : ""
        }`}
      >
        {t("home")}
      </a>
      <a
        href="/filmografias"
        class={`relative pb-2 text-gray-800 hover:text-primary dark:text-white dark:hover:text-primary transition ${
          isActive("/filmografias") ? "border-b-2 border-red-500" : ""
        }`}
      >
        {t("filmography")}
      </a>
      <a
        href="/servicios"
        class={`relative pb-2 text-gray-800 hover:text-primary dark:text-white dark:hover:text-primary transition ${
          isActive("/servicios") ? "border-b-2 border-red-500" : ""
        }`}
      >
        {t("services")}
      </a>
      <a
        href="/about"
        class={`relative pb-2 text-gray-800 hover:text-primary dark:text-white dark:hover:text-primary transition ${
          isActive("/about") ? "border-b-2 border-red-500" : ""
        }`}
      >
        {t("about")}
      </a>
    </div>
  </div>
</header>

<script>
  // Toggle para el menú móvil
  const mobileMenuButton = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");

  if (mobileMenuButton && mobileMenu) {
    mobileMenuButton.addEventListener("click", () => {
      mobileMenu.classList.toggle("hidden");
    });
  }
</script>

<style>
  /* Espacio para que el contenido no quede debajo del header fijo */
  :global(body) {
    padding-top: 70px;
  }
</style>
