
---
import Filmografia from "../lib/models/filmografia";
import mongoose from "mongoose";

// Conectar con Mongo
await mongoose.connect(import.meta.env.MONGO_URL);
const peliculas = await Filmografia.find().lean();
---

<div class="relative w-full min-h-screen bg-gray-100 overflow-hidden">
  <!-- Botón para barajar -->
  <div class="absolute top-4 left-1/2 -translate-x-1/2 z-50">
    <button
      id="shuffleBtn"
      class="px-4 py-2 bg-indigo-600 text-white rounded shadow hover:bg-indigo-700 transition"
    >
      Barajar Posters
    </button>
  </div>

  <!-- Galería de posters -->
  <div id="galeria" class="relative w-full h-screen">
    {peliculas.map((pelicula) => (
      <div
        class="poster absolute cursor-pointer"
        data-id={pelicula._id.toString()}
        style={`top:${Math.random() * 70}%; left:${Math.random() * 70}%; transform: rotate(${Math.random() * 40 - 20}deg);`}
      >
        <img
          src={pelicula.urlPoster}
          alt={pelicula.titulo}
          class="w-40 h-auto rounded shadow-lg border-4 border-white"
        />
      </div>
    ))}
  </div>

  <!-- Modal -->
  <div
    id="modal"
    class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50"
  >
    <div class="bg-white p-6 rounded-lg max-w-md w-full relative">
      <button
        id="cerrar"
        class="absolute top-2 right-2 text-gray-600 hover:text-black"
      >
        ✕
      </button>
      <h2 id="modalTitulo" class="text-xl font-bold mb-2"></h2>
      <img id="modalPoster" class="w-48 mb-4" />
      <p id="modalDescripcion" class="text-sm text-gray-700"></p>
      <a
        id="modalLink"
        href="#"
        target="_blank"
        class="text-indigo-600 underline mt-2 inline-block"
      >
        Ver en IMDb
      </a>
    </div>
  </div>

  <!-- Inyectamos datos en JSON -->
  <script id="pelis-data" type="application/json">
    {JSON.stringify(peliculas)}
  </script>

  <!-- Importamos la lógica -->
  <script type="module">
    import { initGaleria } from "../scripts/galeria.js";
    initGaleria();
  </script>
</div>
